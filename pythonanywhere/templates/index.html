<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes</title>
</head>
<body>
    <header>
        <h1>Notes</h1>
        <a href="/account_page">Account</a>
    </header>
    <main>
        <form id="add-note-form">
            <textarea id="note-text" placeholder="Write a note..." required></textarea>
            <button type="submit">Add Note</button>
        </form>
        <ul id="notes-list"></ul>
    </main>

    <script>
        const sessionKey = sessionStorage.getItem("session_key");
        if (!sessionKey) {
            window.location.href = "/login_page";
        }

        async function fetchNotes() {
            const response = await fetch("http://localhost:5000/notes", {
                headers: { Authorization: `Bearer ${sessionKey}` },
            });
            const notes = await response.json();
            const notesList = document.getElementById("notes-list");
            notesList.innerHTML = notes.map(note => `
                <li>
                    ${note.note}
                    <button onclick="deleteNote(${note.id})">Delete</button>
                </li>
            `).join("");
        }

        async function addNote() {
            const noteText = document.getElementById("note-text").value;
            await fetch("http://localhost:5000/notes", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${sessionKey}`,
                },
                body: JSON.stringify({ note: noteText }),
            });
            fetchNotes();
        }

        async function deleteNote(noteId) {
            await fetch(`http://localhost:5000/notes/${noteId}`, {
                method: "DELETE",
                headers: { Authorization: `Bearer ${sessionKey}` },
            });
            fetchNotes();
        }

        document.getElementById("add-note-form").addEventListener("submit", (e) => {
            e.preventDefault();
            addNote();
        });

        fetchNotes();
    </script>
</body>
</html>
